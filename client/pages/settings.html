<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>settings - SOF</title>
    <link rel="stylesheet" href="../styles/main.css" />
    <style>
      .settings-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 80vh;
      }
      .settings-form-section {
        background: #fff;
        border-radius: 24px;
        box-shadow: 0 8px 32px rgba(133, 72, 54, 0.1);
        padding: 2rem 2.5rem 1.5rem 2.5rem;
        min-width: 350px;
        max-width: 530px;
        margin: 2rem auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 2.5px solid #ffb22c;
      }
      .settings-form-section h1 {
        color: #854836;
        font-size: 2rem;
        margin-bottom: 0.2rem;
        background: none;
        box-shadow: none;
        border-radius: 0;
        padding: 0;
        text-align: center;
      }
      .settings-form-section p {
        color: #ffb22c;
        font-size: 1.1rem;
        /* margin-bottom: 2rem; */
        letter-spacing: 1px;
        text-align: center;
      }
      .settings-form {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
      }
      .form-row {
        display: flex;
        gap: 2rem;
        width: 100%;
        justify-content: center;
      }
      .form-row > label {
        flex: 1 1 0;
        max-width: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }
      .settings-form label {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-weight: 500;
        color: #854836;
        font-size: 1rem;
        margin-bottom: 0.2rem;
      }
      .settings-form input[type='text'],
      .settings-form input[type='password'],
      .settings-form input[type='email'],
      .settings-form input[type='number'],
      .settings-form select {
        width: 100%;
        padding: 0.7rem;
        border: 1.5px solid #ffb22c;
        border-radius: 8px;
        margin-top: 0.5rem;
        margin-bottom: 1.2rem;
        font-size: 1rem;
        background: #fff8ef;
        color: #000;
        transition: border 0.2s;
        text-align: center;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
      }
      .settings-form input:focus,
      .settings-form select:focus {
        border: 2px solid #854836;
        outline: none;
      }
      .settings-form input[type='number']::-webkit-inner-spin-button,
      .settings-form input[type='number']::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      .settings-form input[type='number'] {
        -moz-appearance: textfield;
      }
      .form-actions {
        display: flex;
        gap: 1.2rem;
        width: 100%;
        justify-content: center;
        margin-top: 1rem;
      }
      .settings-form button {
        flex: 1;
        background: #ffb22c;
        color: #000;
        border: none;
        padding: 0.7rem 0;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(133, 72, 54, 0.08);
        transition:
          background 0.2s,
          color 0.2s;
        max-width: 120px;
      }
      .settings-form button.cancel {
        background: #854836;
        color: #fff;
      }
      .settings-form button:hover,
      .settings-form button:focus {
        background: #000;
        color: #ffb22c;
        outline: none;
      }
      @media (max-width: 700px) {
        .form-row {
          flex-direction: column;
          gap: 0.5rem;
        }
        .form-row > label {
          max-width: 100%;
        }
      }
    </style>
    <script defer src="../scripts/api.js"></script>
    <script defer src="../scripts/common.js"></script>
  </head>
  <body>
    <div id="navbar-private"></div>

    <div class="b-content">
      <div class="settings-container">
        <div class="settings-form-section">
          <h1>Edit Settings</h1>
          <p>Edit StockOverFlow Settings of your inventory with ease!</p>
          <form id="settings-form" class="settings-form">
            <div class="form-row">
              <label
                >Name:
                <input type="text" name="name" required />
              </label>
              <label
                >Email:
                <input
                  type="email"
                  name="email"
                  required
                  disabled
                  style="background-color: #eeecec; cursor: not-allowed"
                />
              </label>
            </div>
            <div class="form-row">
              <label
                >Username:
                <input type="text" name="username" required />
              </label>
              <label
                >Phone:
                <input
                  type="text"
                  name="phone"
                  required
                  maxlength="10"
                  pattern="[0-9]{10}"
                  title="Please enter a 10-digit phone number"
                />
              </label>
            </div>
            <div class="form-row">
              <label
                >Country:
                <select name="country" id="country-select" required></select>
              </label>
              <label
                >State/Town:
                <select name="state_town" id="state-select" required></select>
              </label>
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="cancel"
                onclick="window.location.href='dashboard.html'"
              >
                Cancel
              </button>
              <button type="submit">Update</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script>
      const countries = {
        India: [
          'Andhra Pradesh',
          'Arunachal Pradesh',
          'Assam',
          'Bihar',
          'Chhattisgarh',
          'Goa',
          'Gujarat',
          'Haryana',
          'Himachal Pradesh',
          'Jharkhand',
          'Karnataka',
          'Kerala',
          'Madhya Pradesh',
          'Maharashtra',
          'Manipur',
          'Meghalaya',
          'Mizoram',
          'Nagaland',
          'Odisha',
          'Punjab',
          'Rajasthan',
          'Sikkim',
          'Tamil Nadu',
          'Telangana',
          'Tripura',
          'Uttar Pradesh',
          'Uttarakhand',
          'West Bengal',

          'Andaman and Nicobar Islands',
          'Chandigarh',
          'Dadra and Nagar Haveli and Daman and Diu',
          'Delhi',
          'Jammu and Kashmir',
          'Ladakh',
          'Lakshadweep',
          'Puducherry',
        ],
        'United States': [
          'Alabama',
          'Alaska',
          'Arizona',
          'Arkansas',
          'California',
          'Colorado',
          'Connecticut',
          'Delaware',
          'Florida',
          'Georgia',
          'Hawaii',
          'Idaho',
          'Illinois',
          'Indiana',
          'Iowa',
          'Kansas',
          'Kentucky',
          'Louisiana',
          'Maine',
          'Maryland',
          'Massachusetts',
          'Michigan',
          'Minnesota',
          'Mississippi',
          'Missouri',
          'Montana',
          'Nebraska',
          'Nevada',
          'New Hampshire',
          'New Jersey',
          'New Mexico',
          'New York',
          'North Carolina',
          'North Dakota',
          'Ohio',
          'Oklahoma',
          'Oregon',
          'Pennsylvania',
          'Rhode Island',
          'South Carolina',
          'South Dakota',
          'Tennessee',
          'Texas',
          'Utah',
          'Vermont',
          'Virginia',
          'Washington',
          'West Virginia',
          'Wisconsin',
          'Wyoming',
        ],
        Australia: [
          'New South Wales',
          'Queensland',
          'South Australia',
          'Tasmania',
          'Victoria',
          'Western Australia',
          'Australian Capital Territory',
          'Northern Territory',
        ],
      };

      const allCountries = ['India', 'United States', 'Australia'];
      const countrySelect = document.getElementById('country-select');
      const stateSelect = document.getElementById('state-select');

      allCountries.forEach((c) => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        countrySelect.appendChild(opt);
      });
      countrySelect.value = 'India';

      function populateStates(country) {
        stateSelect.innerHTML = '';
        const states = countries[country] || [];
        if (states.length) {
          states.forEach((s) => {
            const opt = document.createElement('option');
            opt.value = s;
            opt.textContent = s;
            stateSelect.appendChild(opt);
          });
        } else {
          const opt = document.createElement('option');
          opt.value = '';
          opt.textContent = 'N/A';
          stateSelect.appendChild(opt);
        }
      }
      populateStates('India');
      countrySelect.addEventListener('change', (e) => {
        populateStates(e.target.value);
      });

      document
        .getElementById('settings-form')
        .addEventListener('submit', async function (e) {
          e.preventDefault();
          const name = this.name.value;
          const email = this.email.value;
          const username = this.username.value;
          const phone = this.phone.value;
          const country = this.country.value;
          const state_town = this.state_town.value;
          const result = await updateUser({
            name,
            email,
            username,
            phone,
            country,
            state_town,
          });
          if (result.status == 201) {
            showToast('Edit successful!');
            setTimeout(() => {
              window.location.href = 'dashboard.html';
            }, 1800);
          } else {
            showToast('Failed: ' + (result.data?.message || 'Error'), 'error');
          }
        });

      async function fetchUserData() {
        const result = await getUser();
        const user = result.data.data.user;
        document.querySelector('input[name="name"]').value = user.name || '';
        document.querySelector('input[name="email"]').value = user.email || '';
        document.querySelector('input[name="username"]').value =
          user.username || '';
        document.querySelector('input[name="phone"]').value = user.phone || '';
        document.querySelector('select[name="country"]').value =
          user.country || '';
        populateStates(user.country || 'India'); // Ensure states are populated before setting value
        document.querySelector('select[name="state_town"]').value =
          user.state_town || '';
      }
      document.addEventListener('DOMContentLoaded', () => {
        fetchUserData();
      });
    </script>
  </body>
</html>
